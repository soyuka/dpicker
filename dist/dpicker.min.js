!function(t,e){"function"==typeof define&&define.amd?define("DPicker",["moment","maquette"],e):"object"==typeof module&&module.exports?module.exports=e(require("moment"),require("maquette")):t.DPicker=e(t.moment,t.maquette)}(this,function(t,e){"use strict";function n(){}function i(t){return function(e,n,i){return function(){return t(e,n,i)}}}function a(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,function(t){return(t^16*Math.random()>>t/4).toString(16)})}function r(t,e){for(;t&&t!==document;){if(t.getAttribute("id")===e)return!0;t=t.parentNode}return!1}function o(n){var i=void 0!==arguments[1]?arguments[1]:{},r=this;if(!(this instanceof o))return new o(n,i);this._container=a();var d=i.model||t();this._data={model:d.clone(),format:i.format||"DD/MM/YYYY",display:void 0!==i.display&&i.display,hideOnDayClick:void 0===i.hideOnDayClick||i.hideOnDayClick,hideOnEnter:void 0===i.hideOnEnter||i.hideOnEnter,min:i.min||t("1986-01-01"),max:i.max||t().add(1,"year").month(11),months:i.months||t.months(),days:i.days||t.weekdaysShort(),inputId:i.inputId||a(),inputName:i.name||"dpicker-input",isEmpty:void 0!==i.model&&!i.model},this.onChange=i.onChange,this.modifier=i.modifier,this._projector=e.createProjector(),this._events=this._loadEvents(),o.modules&&this._loadModules(),document.addEventListener("click",this._events.hide);var s,u,c=this.render(this._events,this._data,[this.renderYears(this._events,this._data),this.renderMonths(this._events,this._data),this.renderDays(this._events,this._data)]);if("INPUT"===n.tagName){if(!n.parentNode)throw new ReferenceError("Can not init DPicker on an input without parent node");this._data.inputId=n.getAttribute("id")||this._data.inputId,this._data.inputName=n.getAttribute("name")||this._data.inputName,"date"==n.getAttribute("type")&&n.setAttribute("type","text"),[["format","format"],["min","min"],["max","max"],["value","model"]].map(function(e,i){var a=e[1];e=e[0];var o=n.getAttribute(e);o&&("format"!==a?r._data[a]=t(o,r._data.format):r._data[a]=o)}),this._projector.merge(n,this.renderInput(this._events,this._data)),s=n.parentNode,s.classList.add("dpicker"),u=c}else u=this.renderContainer(this._events,this._data,[this.renderInput(this._events,this._data),c]),s=n;return this._projector.append(s,u),s.setAttribute("id",this._container),s.addEventListener("keydown",this._events.keyDown),this}var d=e.h;return o.prototype._loadModules=function(){var t,e=this,n=this,i=function(t){if(!o.modules.hasOwnProperty(t))return 0;var i,a=function(i){if(!o.modules[t].hasOwnProperty(i))return 0;var a=i+"-internal";n._events[a]=n._events[i],n._events[i]=function(n){e._events[a]&&e._events[a](n),o.modules[t][i].bind(e)(n)}};t:for(var r in o.modules[t])switch(i=a(r)){case 0:continue t}};t:for(var a in o.modules)switch(t=i(a)){case 0:continue t}},o.prototype._loadEvents=function(){var e=this;return{hide:function(t){if(e._data.display!==!1){var n=t.target;r(n.parentNode,e._container)||(e._data.display=!1,e._projector.scheduleRender())}},inputChange:function(n){if(e._data.input=n.target.value,n.target.value){var i=t(n.target.value,e._data.format);i.isValid()&&(e._data.model=i),e._data.isEmpty=!1}else e._data.isEmpty=!0;e.onChange()},inputBlur:function(t){if(e._data.display!==!1){var n=t.relatedTarget||t.target;r(n.parentNode,e._container)||(e._data.display=!1)}},inputFocus:function(t){e._data.display=!0,t.target&&t.target.select&&t.target.select()},yearChange:function(t){e._data.isEmpty=!1,e._data.model.year(t.target.options[t.target.selectedIndex].value),e.onChange()},monthChange:function(t){e._data.isEmpty=!1,e._data.model.month(t.target.options[t.target.selectedIndex].value),e.onChange()},dayClick:function(t){t.preventDefault(),e._data.model.date(t.target.value),e._data.isEmpty=!1,e.onChange(),e._data.hideOnDayClick&&(e._data.display=!1)},dayKeyDown:function(){},keyDown:function(t){if(e._data.hideOnEnter){var n=t.which||t.keyCode;13!==n&&27!==n||(document.getElementById(e.inputId).blur(),e._data.display=!1)}}}},o.prototype.renderInput=i(function(t,e,n){return d("input#"+e.inputId,{value:e.isEmpty?"":e.model.format(e.format),type:"text",min:e.min.format(e.format),max:e.max.format(e.format),format:e.format,onchange:t.inputChange,onblur:t.inputBlur,onfocus:t.inputFocus,name:e.inputName})}),o.prototype.renderContainer=i(function(t,e,n){return d("div.dpicker",n.map(function(t){return t()}))}),o.prototype.render=i(function(t,e,n){return d("div.dpicker-container",{classes:{"dpicker-visible":e.display,"dpicker-invisible":!e.display}},n.map(function(t){return t()}))}),o.prototype.renderYears=i(function(t,e,n){for(var i=e.model.year(),a=e.max.year()+1,r=e.min.year(),o=[];--a>=r;)o.push(d("option",{value:a,selected:a===i,key:a},""+a));return d("select",{onchange:t.yearChange,name:"dpicker-year"},o)}),o.prototype.renderMonths=i(function(t,e,n){var i=e.model.month(),a=e.model.year(),r=e.months;if(e.max.year()==a){var o=e.max.month();r=r.filter(function(t,e){return e<=o})}else if(e.min.year()==a){var s=e.min.month();r=r.filter(function(t,e){return e>=s})}return d("select",{onchange:t.monthChange,name:"dpicker-month"},r.map(function(t,e){return d("option",{value:e,selected:e===i,key:e},t)}))}),o.prototype.renderDays=i(function(t,e,i){var a,r,o=e.model.daysInMonth(),s=e.model.clone().subtract(1,"months").daysInMonth(),u=+e.model.clone().date(1).format("e")-1,c=e.model.date(),m=new Array(Math.ceil(.1+(u+o)/7)).fill(0);return d("table",[d("tr",e.days.map(function(t){return d("th",t)})),m.map(function(e,i){return d("tr",{key:i},new Array(7).fill(0).map(function(e,m){return m<=u&&0===i?(a=s-(u-m),r=!1):m===u+1&&0===i?(a=1,r=!0):(a===o&&(a=0,r=!1),a++),d("td",{classes:{"dpicker-active":r,"dpicker-inactive":!r}},[d(r?"button":"span",{value:a,onclick:r?t.dayClick:n,type:r?"button":null,onkeydown:r?t.dayKeyDown||n:n,classes:{"dpicker-active":c===a}},a)])}))})])}),Object.defineProperties(o.prototype,{container:{get:function(){return this._container}},inputId:{get:function(){return this._data.inputId}},input:{get:function(){return this._data.input}},onChange:{set:function(t){var e=this;this._onChange=function(){return e.modifier&&e.modifier(),!!t&&t(e._data)}},get:function(){return this._onChange}},modifier:{set:function(t){var e=this;return t?void(this._modifier=function(){t.bind(e)()}):void(this._modifier=null)},get:function(){return this._modifier}}}),["model","format","display","months","days","inputName","min","max"].forEach(function(t){Object.defineProperty(o.prototype,t,{get:function(){return this._data[t]},set:function(e){"model"===t?(this._data.isEmpty=!e,this._data[t]=e?e:this._data[t]):this._data[t]=e,this._projector.scheduleRender()}})}),o.modules={},o});